背景
jidu 中文字体文件有两个包，
暂时无法在 RoboTeam 文档外展示此内容
和
暂时无法在 RoboTeam 文档外展示此内容
，一个 8M 左右，影响 C 端体验。
竞品小鹏的中文字体文件
暂时无法在 RoboTeam 文档外展示此内容
，2.5M。tesla、蔚来只有几百 K（只有英文字体）。
我们的目标是：中文字体文件比竞品小，尽量覆盖常用的文字。

jidu 与小鹏中文字体包对比
使用的工具是百度的 fontedit： https://kekee000.github.io/fonteditor/index.html
第一张图小鹏，第二张图 jidu。
[图片]
[图片]
对比发现：一页 100 个字符，小鹏有 1w 字符，jidu 有 3.1w 字符，这也就解释了为什么字体文件大小 jidu 是小鹏的 3 倍。
结论：一个字符大概 0.25k，我们可以对常见的中文字符进行删减，控制在 4k 左右（中文常见字 3500 个左右），字体文件能控制在 1M。
[图片]
能否控制在 1M 以下呢？也是可以的。
业内的优化方案
调研了业内字体减包方案， 思路都是一致的，就是按页面需要展示的文字生成字体文件，核心就是减少字体文件中的字符个数。
方案 1. font spider
通过 spider 工具，对 html 页面进行爬虫，分析出 html 页面所需要展示的中文字符，然后生成对应的中文字体文件。
使用方法可参考： https://juejin.cn/post/6904541605265899527 ， https://github.com/aui/font-spider
工作原理：
[图片]
方案的优点：

- 压缩字体：智能删除没有被使用的字形数据，大幅度减少字体体积；
- 生成字体：支持 woff2、woff、eot、svg 字体格式生成；
  方案的缺陷：
- 只能解析静态 html 文件，没办法动态解析 spa 页面，也就是说使用到的中文必须在 html 中静态标记，无法处理动态插入的 html 片段；
- 没办法处理后端接口提供的文字；
  方案 2. fontmin
  fontmin 是一个创建字体子集的工具，提供【命令行工具】和【可视化工具】两种方式。
  [图片]
  方案的缺陷：
- 需要提前准备页面中用到的所有字符，不太适合频繁改动的页面。

方案 3. font-spider-plus
font-spider 的加强版，支持动态解析页面。
工作原理：利用 puppeteer 在 headless 模式下打开页面，然后讲动态渲染后的 html 片段导出，最后使用 font-spider 进行处理。
方案的缺陷：

- headless 模式下的页面渲染不能百分百还原线上页面；
- 无法自动处理，手动操作成本高；

方案 4. spa-font-spider-webpack-plugin
一个基于 font-spider 的，适用于 SPA 项目中动态渲染出的 web 字体提取、压缩的 webpack 插件。
工作原理： 1.对于首页，动态解析出缩量字体包，并将字体包一起打包进构建的 web 包； 2.同时加载全量包，等用户切换到非首页页面，可以使用自定义字体渲染出字符；

思考：
方案 4 的思路可以借鉴，
把一级页面中的字 和 常见字，大概选 1K 个，这样估计 200k 左右；
然后加载全量字（4k 个，1M），缓存起来；
跳转其他页面，字体可生效；
